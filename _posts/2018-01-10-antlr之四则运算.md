---
title: antlr之四则运算
layout: post
tags: antlr
---
##文法文件如下：

    grammar Calc;

    prog
        : stat+
        ;

    stat
        : expr						
        | ID '=' expr  
        ;  

    expr
        : expr ('*'|'/') expr
        | expr ('+'|'-') expr
        | INT
        | ID
        | '(' expr ')'
        ;

    ID  : [a-zA-Z]+ ;

    INT : [0-9]+ ;

    WS  : [ \t\r\n]+ -> skip ;
    
##使用Visitor模式计算结果
为了给前面的算术表达式语法分析器计算出结果，我们还需要做些其它的事情。

ANTLR v4鼓励我们保持语法的整洁，使用语法分析树Visitor和其它遍历器来实现语言应用。不过在接触这些之前，我们需要对语法做些修改。

首先，我们需要用标签标明规则的选项，标签可以是和规则名没有冲突的任意标志符。如果选项上没有标签，ANTLR只会为每个规则生成一个visit方法。

在本例中，我们希望为每个选项生成一个不同的visit方法，以便每种输入短语都能得到不同的事件。在新的语法中，标签出现在选项的右边缘，且以“#”符号开头：  

	stat
	    : expr                   # printExpr
	    | ID '=' expr            # assign
	    ;
	
	expr
	    : expr op=(MUL|DIV) expr # MulDiv
	    | expr op=(ADD|SUB) expr # AddSub
	    | INT                    # int
	    | ID                     # id
	    | '(' expr ')'           # parens
	    ;  
接下来，让我们为运算符字面量定义一些记号名字，以便以后可以在visit方法中引用作为Java常量的它们：  

    MUL : '*' ;  
	
    DIV : '/' ;
	
    ADD : '+' ;  
	
    SUB : '-' ;